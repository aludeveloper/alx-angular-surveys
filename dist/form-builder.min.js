angular.module("mwFormBuilder",["ngSanitize","ng-sortable","pascalprecht.translate"]),angular.module("mwFormBuilder").filter("trustAsHtml",["$sce",function(e){return function(n){return e.trustAsHtml(n)}}]),angular.module("mwFormBuilder").service("mwFormUuid",function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}this.get=function(){return e()+e()+e()+e()+e()+e()+e()+e()}}).factory("mwFormClone",["mwFormUuid",function(e){var n={},o=[];return n.resetIds=function(r,t){if(t&&(o=[]),!(o.indexOf(r)>=0)&&(o.push(r),!r!==Object(r))){if(Array.isArray(r))return void r.forEach(n.resetIds);for(var i in r)r.hasOwnProperty(i)&&n.resetIds(r[i]);if(r.hasOwnProperty("id")){var a=e.get();r.id;r.id=a}}},n.cloneElement=function(e){var o={};return angular.copy(e,o),n.resetIds(o,!0),o},n.clonePage=function(o){var r={};angular.copy(o,r),r.id=e.get();var t=[];if(Array.isArray(o.elements))for(var i=0;i<o.elements.length;i++)t.push(n.cloneElement(o.elements[i]));return r.elements=t,r},n.cloneForm=function(e){var o={};angular.copy(e,o);var r=[];if(Array.isArray(e.pages))for(var t=0;t<e.pages.length;t++)r.push(n.clonePage(e.pages[t]));return o.pages=r,o},n}]),angular.module("mwFormBuilder").directive("mwQuestionPriorityListBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-question-priority-list-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(e){function n(e){if(e)for(var n=0;n<e.length;n++){var o=e[n];o.orderNo=n+1}}function o(e){e.sort(function(e,n){return e.orderNo-n.orderNo})}var r=this;r.isNewItem={},this.$onInit=function(){r.question.priorityList||(r.question.priorityList=[],r.addNewItem()),o(r.question.priorityList),r.itemsSortableConfig={disabled:r.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,o){n(r.question.priorityList)}}},r.addNewItem=function(n){var o={id:e.get(),orderNo:r.question.priorityList.length+1,value:null};n||(r.isNewItem[o.id]=!0),r.question.priorityList.push(o)},r.removeItem=function(e){var n=r.question.priorityList.indexOf(e);n!=-1&&r.question.priorityList.splice(n,1)},r.keyPressedOnInput=function(e,n){delete r.isNewItem[n.id],13===e.which&&(e.preventDefault(),r.addNewItem())},1===angular.version.major&&angular.version.minor<5&&this.$onInit()}],link:function(e,n,o,r){e.ctrl}}}),angular.module("mwFormBuilder").directive("mwQuestionOfferedAnswerListBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",pageNumber:"=",formObject:"=",readOnly:"=?",options:"=?",disableOtherAnswer:"=?",fileReader:"="},templateUrl:"mw-question-offered-answer-list-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["FormQuestionBuilderId","mwFormUuid",function(e,n){function o(){if(t.question.offeredAnswers)for(var e=0;e<t.question.offeredAnswers.length;e++){var n=t.question.offeredAnswers[e];n.orderNo=e+1}}function r(){t.question.offeredAnswers&&t.question.offeredAnswers.sort(function(e,n){return e.orderNo-n.orderNo})}var t=this;this.$onInit=function(){t.config={radio:{},checkbox:{}},t.isNewAnswer={},r(),t.offeredAnswersSortableConfig={disabled:t.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,n){o()}}},t.addNewOfferedAnswer=function(){var e=t.possiblePageFlow[0],o={id:n.get(),orderNo:t.question.offeredAnswers.length+1,value:null,pageFlow:e,linkedquestion:null};t.isNewAnswer[o.id]=!0,t.question.offeredAnswers.push(o)},t.removeOfferedAnswer=function(e){var n=t.question.offeredAnswers.indexOf(e);n!=-1&&t.question.offeredAnswers.splice(n,1)},t.addCustomAnswer=function(){t.question.otherAnswer=!0},t.removeCustomAnswer=function(){t.question.otherAnswer=!1},t.processData=function(e){for(var o=e.split(/\r\n|\n/),r=o[0].split(","),i=t.possiblePageFlow[0],a=0;a<o.length;a++){var l,u=o[a].split(",");if(u.length==r.length)for(var s=0;s<r.length;s++)l={id:n.get(),orderNo:t.question.offeredAnswers.length+1,value:u[s],pageFlow:i,linkedquestion:null},t.question.offeredAnswers.push(l),t.isNewAnswer[l.id]=!0}},t.keyPressedOnInput=function(e,n){delete t.isNewAnswer[n.id],13===e.which&&(e.preventDefault(),t.addNewOfferedAnswer())},1===angular.version.major&&angular.version.minor<5&&this.$onInit()}],link:function(e,n,o,r){var t=e.ctrl,i=t.pageNumber-1;t.possiblePageFlow=r.possiblePageFlow,t.elements=r.formObject.pages[i].elements,n.bind("change",function(e){var n=e.target.files,o=new FileReader;n&&n.length>0&&(o.onload=function(e){e.target.result},o.readAsText(n[0]),setTimeout(function(){t.processData(o.result)},100))})}}}),angular.module("mwFormBuilder").directive("mwQuestionGridBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",formObject:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-question-grid-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid","MW_GRID_CELL_INPUT_TYPES",function(e,n){function o(e){if(e)for(var n=0;n<e.length;n++){var o=e[n];o.orderNo=n+1}}function r(e){e.sort(function(e,n){return e.orderNo-n.orderNo})}var t=this;this.$onInit=function(){t.cellInputTypes=n,t.isNewInput={},t.question.grid||(t.question.grid={rows:[],cols:[]},t.addNewRow(),t.addNewCol(!0)),t.question.grid.cellInputType||(t.question.grid.cellInputType=t.cellInputTypes[0]),r(t.question.grid.rows),r(t.question.grid.cols),t.rowsSortableConfig={disabled:t.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,n){o(t.question.grid.rows)}},t.colsSortableConfig={disabled:t.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,n){o(t.question.grid.cols)}}},t.addNewRow=function(n){var o={id:e.get(),orderNo:t.question.grid.rows.length+1,label:null};n||(t.isNewInput[o.id]=!0),t.question.grid.rows.push(o)},t.addNewCol=function(n){var o={id:e.get(),orderNo:t.question.grid.cols.length+1,label:null};n||(t.isNewInput[o.id]=!0),t.question.grid.cols.push(o)},t.removeRow=function(e){var n=t.question.grid.rows.indexOf(e);n!=-1&&t.question.grid.rows.splice(n,1)},t.removeCol=function(e){var n=t.question.grid.cols.indexOf(e);n!=-1&&t.question.grid.cols.splice(n,1)},t.keyPressedOnInput=function(e,n,o){delete t.isNewInput[n.id],13===e.which&&(e.preventDefault(),"row"==o?t.addNewRow():t.addNewCol())},1===angular.version.major&&angular.version.minor<5&&this.$onInit()}],link:function(e,n,o,r){e.ctrl}}}),angular.module("mwFormBuilder").directive("mwQuestionDivisionBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestionBuilder",scope:{question:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-question-division-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(e){function n(e){if(e)for(var n=0;n<e.length;n++){var o=e[n];o.orderNo=n+1}}function o(e){e.sort(function(e,n){return e.orderNo-n.orderNo})}var r=this;r.$onInit=function(){r.isNewItem={},r.question.divisionList||(r.question.divisionList=[],r.addNewItem()),o(r.question.divisionList),r.itemsSortableConfig={disabled:r.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,o){n(r.question.divisionList)}}},r.addNewItem=function(n){var o={id:e.get(),orderNo:r.question.divisionList.length+1,value:null};n||(r.isNewItem[o.id]=!0),r.question.divisionList.push(o)},r.removeItem=function(e){var n=r.question.divisionList.indexOf(e);n!=-1&&r.question.divisionList.splice(n,1)},r.keyPressedOnInput=function(e,n){delete r.isNewItem[n.id],13===e.which&&(e.preventDefault(),r.addNewItem())},1===angular.version.major&&angular.version.minor<5&&r.$onInit()}],link:function(e,n,o,r){e.ctrl}}}),angular.module("mwFormBuilder").directive("mwLabel",function(){return{replace:!0,restrict:"AE",scope:{labelKey:"@?",labelText:"@?",labelFor:"@",labelClass:"@",labelTranslateValues:"="},templateUrl:"mw-label.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid",function(e){}],link:function(e,n,o){}}}),angular.module("mwFormBuilder").factory("FormVideoLinkBuilderId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormVideolinkBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageElementBuilder",scope:{videolink:"=",formObject:"=",onReady:"&",isPreview:"=?",readOnly:"=?"},templateUrl:"mw-form-videolink-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormVideoLinkBuilderId",function(e,n){var o=this;void 0,o.$onInit=function(){o.id=n.next(),o.formSubmitted=!1},o.save=function(){o.formSubmitted=!0,o.onReady()},1===angular.version.major&&angular.version.minor<5&&o.$onInit()}],link:function(e,n,o,r){e.ctrl}}}),angular.module("mwFormBuilder").factory("FormQuestionBuilderId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormQuestionBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageElementBuilder",scope:{question:"=",pageNumber:"=",formObject:"=",onReady:"&",isPreview:"=?",readOnly:"=?"},templateUrl:"mw-form-question-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormQuestionBuilderId","mwFormBuilderOptions",function(e,n,o){function r(){if(a.question.offeredAnswers)for(var e=0;e<a.question.offeredAnswers.length;e++)a.question.offeredAnswers[e].orderNo=e+1}function t(){a.question.offeredAnswers&&a.question.offeredAnswers.sort(function(e,n){return e.orderNo-n.orderNo})}function i(){a.question.offeredAnswers&&a.question.offeredAnswers.forEach(function(e){a.question.pageFlowModifier?e.pageFlow=a.possiblePageFlow[0]:delete e.pageFlow})}var a=this;a.$onInit=function(){a.id=n.next(),a.questionTypes=o.questionTypes,a.formSubmitted=!1,t(),a.offeredAnswersSortableConfig={disabled:a.readOnly,ghostClass:"beingDragged",handle:".drag-handle",onEnd:function(e,n){r()}}},a.save=function(){a.formSubmitted=!0,a.form.$valid&&a.onReady()};var l=["radio","checkbox","select"];a.questionTypeChanged=function(){l.indexOf(a.question.type)!==-1&&(a.question.offeredAnswers||(a.question.offeredAnswers=[])),"radio"!=a.question.type&&(i(),e(function(){a.question.pageFlowModifier=!1})),l.indexOf(a.question.type)===-1&&delete a.question.offeredAnswers,"grid"!=a.question.type&&delete a.question.grid,"priority"!=a.question.type&&delete a.question.priorityList},a.pageFlowModifierChanged=function(){i()},1===angular.version.major&&angular.version.minor<5&&a.$onInit()}],link:function(e,n,o,r){var t=e.ctrl;t.possiblePageFlow=r.possiblePageFlow,t.options=r.options}}}),angular.module("mwFormBuilder").factory("FormParagraphConditionBuilderId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormParagraphConditionBuilder",["$rootScope",function(e){return{replace:!0,restrict:"AE",require:"^mwFormPageElementBuilder",scope:{paragraphcondition:"=",paragraphconditionfalse:"=",paragraphconditionunset:"=",paragraphconditionsubtext:"=",selecteditem:"=",formObject:"=",onReady:"&",isPreview:"=?",readOnly:"=?"},templateUrl:"mw-form-paragraphcondition-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormParagraphConditionBuilderId",function(n,o){var r=this;r.$onInit=function(){r.id=o.next(),r.formSubmitted=!1},r.save=function(){r.formSubmitted=!0,r.onReady()},r.saveKey=function(n){void 0,e.selectedSfKey=n.key},r.test=function(){r.selecteditem,void 0,void 0},1===angular.version.major&&angular.version.minor<5&&r.$onInit()}],link:function(e,n,o,r){var t=e.ctrl;t.options=r.options}}}]),angular.module("mwFormBuilder").factory("FormParagraphBuilderId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormParagraphBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageElementBuilder",scope:{paragraph:"=",formObject:"=",onReady:"&",isPreview:"=?",readOnly:"=?"},templateUrl:"mw-form-paragraph-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormParagraphBuilderId",function(e,n){var o=this;o.requiredPara=!1,o.number=100,o.getNumber=function(e){return new Array(e)},o.$onInit=function(){o.id=n.next(),o.formSubmitted=!1},o.save=function(){o.paragraph.html=$(".summernote").summernote("code"),o.formSubmitted=!0,$(".summernote").summernote("isEmpty")?o.requiredPara=!0:(o.requiredPara=!1,o.onReady())},1===angular.version.major&&angular.version.minor<5&&o.$onInit()}],link:function(e,n,o,r){var t=e.ctrl;t.options=r.options}}}),angular.module("mwFormBuilder").directive("mwFormPageElementBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageBuilder",scope:{pageElement:"=",pageNumber:"=",formObject:"=",isActive:"=",isFirst:"=",isLast:"=",onReady:"&",readOnly:"=?"},templateUrl:"mw-form-page-element-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid","$rootScope",function(e,n){var o=this;void 0!=n.defaultRowNumber&&null!=n.defaultRowNumber||(n.defaultRowNumber=0),o.$onInit=function(){"question"==o.pageElement.type?o.pageElement.question||(o.pageElement.question={id:e.get(),text:null,type:null,required:!0}):"image"==o.pageElement.type?o.pageElement.image||(o.pageElement.image={id:e.get(),align:"left"}):"paragraph"==o.pageElement.type?o.pageElement.paragraph||(o.pageElement.paragraph={id:e.get(),html:""}):"paragraphcondition"==o.pageElement.type?o.pageElement.paragraphcondition||(o.pageElement.paragraphcondition={id:e.get(),html:""},o.pageElement.paragraphconditionfalse={id:e.get(),html:""},o.pageElement.paragraphconditionunset={id:e.get(),html:""},o.pageElement.paragraphconditionsubtext={id:e.get(),html:""},o.pageElement.selecteditem={id:e.get(),sfkey:""}):"videolink"==o.pageElement.type&&(void 0,o.pageElement.videolink||(o.pageElement.videolink={id:e.get(),html:""}))},o.rowLimit=n.defaultRowNumber+1,o.updateDefaultRow=function(e){n.defaultRowNumber=e++},o.callback=function(e,n){e.preventDefault(),e.stopPropagation(),n.callback&&"function"==typeof n.callback&&n.callback(o.pageElement)},o.filter=function(e){return!(!e.showInOpen&&o.isActive)&&(!(!e.showInPreview&&!o.isActive)&&(!e.filter||"function"!=typeof e.filter||e.filter(o.pageElement)))},1===angular.version.major&&angular.version.minor<5&&o.$onInit()}],link:function(e,n,o,r){var t=e.ctrl;t.possiblePageFlow=r.possiblePageFlow,t.hoverIn=function(){t.isHovered=!0},t.hoverOut=function(){t.isHovered=!1},t.editElement=function(){r.selectElement(t.pageElement)},t.cloneElement=function(e){e.preventDefault(),e.stopPropagation(),r.cloneElement(t.pageElement)},t.removeElement=function(){r.removeElement(t.pageElement)},t.moveDown=function(){r.moveDownElement(t.pageElement)},t.moveUp=function(){r.moveUpElement(t.pageElement)},t.options=r.options,t.onImageSelection=r.onImageSelection}}}),angular.module("mwFormBuilder").directive("mwFormPageBuilder",["$rootScope",function(e){return{replace:!0,restrict:"AE",require:"^mwFormBuilder",scope:{formPage:"=",formObject:"=",isFirst:"=",isLast:"=",readOnly:"=?"},templateUrl:"mw-form-page-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","mwFormUuid","mwFormClone","mwFormBuilderOptions",function(n,o,r,t){function i(){for(var e=0;e<s.formPage.elements.length;e++)s.formPage.elements[e].orderNo=e+1}function a(){s.formPage.elements.sort(function(e,n){return e.orderNo-n.orderNo})}function l(e,n,r){return{id:o.get(),orderNo:n,type:e,rowNumber:r}}function u(e,n,o){var r=e[n];e.splice(n,1),e.splice(o,0,r)}var s=this;s.$onInit=function(){s.hoverEdit=!1,s.formPage.namedPage=!!s.formPage.name,s.isFolded=!1,a(),s.sortableConfig={disabled:s.readOnly,ghostClass:"beingDragged",group:"survey",handle:".inactive",chosenClass:".page-element-list",onEnd:function(e,n){i()}},s.activeElement=null},s.unfold=function(){s.isFolded=!1},s.fold=function(){s.isFolded=!0},s.pageNameChanged=function(){e.$broadcast("mwForm.pageEvents.pageNameChanged",{page:s.formPage})},s.addElement=function(n){n||(n=t.elementTypes[0]),e.defaultRowNumber++;var o=l(n,s.formPage.elements.length+1,e.defaultRowNumber);s.activeElement=o,s.formPage.elements.push(o)},s.cloneElement=function(e,n){var o=s.formPage.elements.indexOf(e),t=r.cloneElement(e);n&&(s.activeElement=t),s.formPage.elements.splice(o,0,t)},s.removeElement=function(n){var o=s.formPage.elements.indexOf(n);s.formPage.elements.splice(o,1),e.defaultRowNumber=e.defaultRowNumber-1},s.moveDownElement=function(e){var n=s.formPage.elements.indexOf(e),o=n+1;o<s.formPage.elements.length&&u(s.formPage.elements,n,o),i()},s.moveUpElement=function(e){var n=s.formPage.elements.indexOf(e),o=n-1;o>=0&&u(s.formPage.elements,n,o),i()},s.isElementTypeEnabled=function(e){return t.elementTypes.indexOf(e)!==-1},s.addQuestion=function(){s.addElement("question")},s.addImage=function(){s.addElement("image")},s.addParagraph=function(){s.addElement("paragraph"),n(function(){$(".summernote").summernote({placeholder:"Enter paragraph text"})},1e3)},s.addParagraphCondition=function(){s.addElement("paragraphcondition")},s.addVideoLink=function(){s.addElement("videolink")},s.isElementActive=function(e){return s.activeElement==e},s.selectElement=function(e){s.activeElement=e,"paragraph"==s.activeElement.type&&n(function(){$(".summernote").summernote({focus:!0})},1e3)},s.onElementReady=function(){n(function(){s.activeElement=null})},s.hoverIn=function(){s.hoverEdit=!0},s.hoverOut=function(){s.hoverEdit=!1},s.updateElementsOrderNo=i,1===angular.version.major&&angular.version.minor<5&&s.$onInit()}],link:function(e,n,o,r){var t=e.ctrl;t.possiblePageFlow=r.possiblePageFlow,t.moveDown=function(){r.moveDownPage(t.formPage)},t.moveUp=function(){r.moveUpPage(t.formPage)},t.removePage=function(){r.removePage(t.formPage)},t.addPage=function(){r.addPageAfter(t.formPage)},e.$watch("ctrl.formPage.elements.length",function(e,n){e!=n&&t.updateElementsOrderNo()}),t.options=r.options,t.onImageSelection=r.onImageSelection}}}]),angular.module("mwFormBuilder").factory("FormImageBuilderId",function(){var e=0;return{next:function(){return++e}}}).directive("mwFormImageBuilder",function(){return{replace:!0,restrict:"AE",require:"^mwFormPageElementBuilder",scope:{image:"=",formObject:"=",onReady:"&",isPreview:"=?",readOnly:"=?",onImageSelection:"&"},templateUrl:"mw-form-image-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormImageBuilderId","mwFormUuid",function(e,n,o){var r=this;r.id=n.next(),r.formSubmitted=!1,r.save=function(){r.formSubmitted=!0,r.form.$valid&&r.onReady()},r.imageClick=function(){document.getElementById("imageName").click()},r.selectImageButtonClicked=function(){var e=r.onImageSelection();e.then(function(e){r.image.src=e})["catch"](function(){})},r.selectImage=function(e){var n=e.files[0].type;if("image/jpeg"==n||"image/jpg"==n||"image/png"==n||"image/tif"==n){if(e.files&&e.files[0]){var o=new FileReader;o.onload=function(e){$("#myImage").attr("src",e.target.result).width(150).height(200),r.image.src=e.target.result},o.readAsDataURL(e.files[0])}}else void 0},r.setAlign=function(e){r.image.align=e}}],link:function(e,n,o,r){e.ctrl}}}),angular.module("mwFormBuilder").directive("mwFormConfirmationPageBuilder",function(){return{replace:!0,restrict:"AE",scope:{formObject:"=",readOnly:"=?"},templateUrl:"mw-form-confirmation-page-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout",function(e){var n=this;n.hoverEdit=!1,n.hoverIn=function(){n.hoverEdit=!0},n.hoverOut=function(){n.hoverEdit=!1}}],link:function(e,n,o){}}}),angular.module("mwFormBuilder").directive("mwFormBuilder",["$rootScope",function(e){return{replace:!0,restrict:"AE",scope:{formData:"=",readOnly:"=?",options:"=?",formStatus:"=?",onImageSelection:"&",api:"=?"},templateUrl:"mw-form-builder.html",controllerAs:"ctrl",bindToController:!0,controller:["mwFormUuid","MW_QUESTION_TYPES","mwFormBuilderOptions",function(n,o,r){function t(e){var o=null;return l.possiblePageFlow&&(o=l.possiblePageFlow[0]),{id:n.get(),number:e,name:null,description:null,pageFlow:o,elements:[]}}function i(){for(var e=0;e<l.formData.pages.length;e++)l.formData.pages[e].number=e+1;l.updatePageFlow()}function a(e,n,o){var r=e[n];e.splice(n,1),e.splice(o,0,r)}var l=this;l.$onInit=function(){l.currentPage=0,l.formData.pages&&l.formData.pages.length||(l.formData.pages=[],l.formData.pages.push(t(1))),l.options=r.$init(l.options),l.api&&(l.api.reset=function(){for(var n in l.formData)l.formData.hasOwnProperty(n)&&"pages"!=n&&delete l.formData[n];l.formData.pages.length=0,l.formData.pages.push(t(1)),e.defaultRowNumber=0})},l.numberOfPages=function(){return Math.ceil(l.formData.pages.length/l.options.pageSize)},l.lastPage=function(){l.currentPage=Math.ceil(l.formData.pages.length/l.options.pageSize-1)},l.addPage=function(){l.formData.pages.push(t(l.formData.pages.length+1)),l.lastPage(),e.$broadcast("mwForm.pageEvents.pageAdded")},l.onChangePageSize=function(){l.currentPage>Math.ceil(l.formData.pages.length/l.options.pageSize-1)&&(l.currentPage=Math.ceil(l.formData.pages.length/l.options.pageSize-1))},l.addPageAfter=function(n){var o=l.formData.pages.indexOf(n),r=o+1,a=t(n.number+1);r<l.formData.pages.length?l.formData.pages.splice(r,0,a):l.formData.pages.push(a),i(),e.$broadcast("mwForm.pageEvents.pageAdded")},l.moveDownPage=function(n){var o=l.formData.pages.indexOf(n),r=o+1;r<l.formData.pages.length&&a(l.formData.pages,o,r),i(),e.$broadcast("mwForm.pageEvents.pageMoved")},l.moveUpPage=function(n){var o=l.formData.pages.indexOf(n),r=o-1;r>=0&&a(l.formData.pages,o,r),i(),e.$broadcast("mwForm.pageEvents.pageMoved")},l.removePage=function(n){var o=l.formData.pages.indexOf(n);l.formData.pages.splice(o,1),e.defaultRowNumber=0,i(),e.$broadcast("mwForm.pageEvents.pageRemoved"),l.onChangePageSize()},1===angular.version.major&&angular.version.minor<5&&l.$onInit()}],link:function(n,o,r){var t=n.ctrl;t.formStatus&&(t.formStatus.form=t.form),t.possiblePageFlow=[];var i={nextPage:!0,label:"mwForm.pageFlow.goToNextPage"};t.possiblePageFlow.push(i),t.isSamePageFlow=function(e,n){return e.page&&n.page&&e.page.id==n.page.id||e.formSubmit&&n.formSubmit||e.nextPage&&n.nextPage},t.updatePageFlow=function(){t.possiblePageFlow.length=1,t.formData.pages.forEach(function(e){t.possiblePageFlow.push({page:{id:e.id,number:e.number},label:"mwForm.pageFlow.goToPage"})}),t.possiblePageFlow.push({formSubmit:!0,label:"mwForm.pageFlow.submitForm"}),t.formData.pages.forEach(function(e){t.possiblePageFlow.forEach(function(n){e.pageFlow?t.isSamePageFlow(n,e.pageFlow)&&(e.pageFlow=n):e.pageFlow=i,e.elements.forEach(function(e){var o=e.question;o&&o.pageFlowModifier&&o.offeredAnswers.forEach(function(e){e.pageFlow&&t.isSamePageFlow(n,e.pageFlow)&&(e.pageFlow=n)})})})})},n.$watch("ctrl.formData.pages.length",function(e,n){t.updatePageFlow()}),n.$watch("ctrl.currentPage",function(n,o){e.$broadcast("mwForm.pageEvents.pageCurrentChanged",{index:t.currentPage})}),n.$on("mwForm.pageEvents.changePage",function(e,n){"undefined"!=typeof n.page&&n.page<t.numberOfPages()&&(t.currentPage=n.page)}),n.$on("mwForm.pageEvents.addPage",function(e,n){t.addPage()})}}}]),angular.module("mwFormBuilder").filter("mwStartFrom",function(){return function(e,n){return n=+n,e.slice(n)}}),angular.module("mwFormBuilder").constant("MW_QUESTION_TYPES",["text","textarea","radio","checkbox","select","grid","priority","division","number","date","time","email","range","url","file","telephone"]).constant("MW_ELEMENT_TYPES",["question","image","paragraph","paragraphConditionTrue","videolink"]).constant("MW_GRID_CELL_INPUT_TYPES",["radio","checkbox","text","number","date","time"]).factory("mwFormBuilderOptions",["MW_ELEMENT_TYPES","MW_QUESTION_TYPES",function(e,n){function o(e,n){return e?e.map(function(e){return angular.extend({},n,e)}):[]}var r={title:null,icon:null,text:null,callback:null,filter:null,showInOpen:!1,showInPreview:!0,cssClass:""},t={key:null,label:null,selects:[],required:!0},i={elementTypes:e,questionTypes:n,elementButtons:[],pagesSize:[10,25,50,100],pageSize:10,customQuestionSelects:[],customElements:[]},a={$init:function(e){return angular.extend(a,i,e),a.customQuestionSelects=o(a.customQuestionSelects,t),a.elementButtons=o(a.elementButtons,r),a}};return a}]),angular.module("mwFormBuilder").directive("wdFocusMe",["$timeout","$parse",function(e,n){return{link:function(o,r,t){var i=n(t.wdFocusMe);o.$watch(i,function(n){n===!0&&e(function(){r[0].focus()})}),r.bind("blur",function(){e(function(){o.$apply(i.assign(o,!1))})})}}}]).factory("focus",["$timeout","$window",function(e,n){return function(o){e(function(){var e=n.document.getElementById(o);e&&e.focus()})}}]),angular.module("mwFormBuilder").directive("mwConfirmClick",["$window",function(e){return{restrict:"A",link:function(n,o,r){var t=r.wdConfirmClick||"Are you sure?";o.bind("click",function(o){e.confirm(t)&&n.$apply(r.confirmedAction)})}}}]);