angular.module("mwFormViewer",["ngSanitize","ui.bootstrap","ng-sortable","pascalprecht.translate"]),angular.module("mwFormViewer").directive("mwPriorityList",function(){return{replace:!0,restrict:"AE",require:"^mwFormQuestion",scope:{question:"=",questionResponse:"=",readOnly:"=?",options:"=?"},templateUrl:"mw-priority-list.html",controllerAs:"ctrl",bindToController:!0,controller:function(){function e(e){if(e)for(var t=0;t<e.length;t++){var n=e[t];n.priority=t+1}}function t(e){e.sort(function(e,t){return e.priority-t.priority})}var n=this;this.$onInit=function(){n.questionResponse.priorityList||(n.questionResponse.priorityList=[]),n.idToItem={},t(n.questionResponse.priorityList),n.availableItems=[],n.question.priorityList.forEach(function(e){n.idToItem[e.id]=e;var t=n.questionResponse.priorityList.some(function(t){return e.id==t.id});t||n.availableItems.push({priority:null,id:e.id})}),n.allItemsOrdered=0==n.availableItems.length||null;var o={disabled:n.readOnly,ghostClass:"beingDragged"};n.orderedConfig=angular.extend({},o,{group:{name:"A",pull:!1,put:["B"]},onEnd:function(t,o){e(n.questionResponse.priorityList)}}),n.availableConfig=angular.extend({},o,{sort:!1,group:{name:"B",pull:["A"],put:!1},onEnd:function(t,o){e(n.questionResponse.priorityList),n.allItemsOrdered=0==n.availableItems.length||null}})},1===angular.version.major&&angular.version.minor<5&&this.$onInit()},link:function(e,t,n,o){var s=e.ctrl;s.print=o.print}}}),angular.module("mwFormViewer").directive("mwFormViewer",["$rootScope",function(e){return{replace:!0,restrict:"AE",scope:{formData:"=",responseData:"=",templateData:"=?",readOnly:"=?",options:"=?",formStatus:"=?",onSubmit:"&",onSave:"&",onBack:"&",api:"=?"},templateUrl:"mw-form-viewer.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","$interpolate","$localStorage","$cookies",function(t,n,o,s){function r(){i.formData.pages.sort(function(e,t){return e.number-t.number})}var i=this,a=e;i.largeFileFlag=!1,i.hideSaveButton=localStorage.getItem("hideSaveButton"),void 0!=i.hideSaveButton&&""!=i.hideSaveButton||(i.hideSaveButton=!1),e.$on("fileRequiredFlag",function(e,t){i.largeFileFlag=t}),e.$on("hideSaveButton",function(e,t){i.hideSaveButton=t.hideSaveButton}),i.$onInit=function(){i.condtionalParaFlag=!0,i.defaultOptions={nestedForm:!1,autoStart:!1,disableSubmit:!1},i.options=angular.extend({},i.defaultOptions,i.options),i.submitStatus="NOT_SUBMITTED",i.formSubmitted=!1,r(),i.pageIdToPage={},i.formData.pages.forEach(function(e){i.pageIdToPage[e.id]=e}),i.buttons={prevPage:{visible:!1,disabled:!1},nextPage:{visible:!1,disabled:!1},submitForm:{visible:!1,disabled:!1}},a.submitButton=i.buttons.submitForm.visible,a.formValid=i.form,i.resetPages(),i.api&&(i.api.reset=function(){for(var e in i.responseData)i.responseData.hasOwnProperty(e)&&delete i.responseData[e];i.buttons.submitForm.visible=!1,a.submitButton=i.buttons.submitForm.visible,a.formValid=i.form,i.buttons.prevPage.visible=!1,i.buttons.nextPage.visible=!1,i.currentPage=null,t(i.resetPages,0)})},i.getSfFlagValue=function(){var e;angular.forEach(i.formData.pages,function(t,n){angular.forEach(t.elements,function(t,n){t.selecteditem&&t.selecteditem.sfkey&&"paragraphcondition"===t.type&&(e=t.selecteditem.sfkey.key)})});var t,n,r=o.get("auth_token"),a="http://localhost:9000/",u=JSON.parse(s.get("userInfo")),l=u.applicationIdMap,g=o.get("applicationName");angular.forEach(l,function(e,t){g=t,n=e}),""!=e&&void 0!=e&&""!=g&&void 0!=g&&$.ajax({async:!1,headers:{"X-AUTH-TOKEN":r,"content-Type":"Application/Json"},url:a+"salesforce/conditionalpara/"+e+"/"+g+"/"+u.email,success:function(e){void 0,t=e}}),i.sfFlag=t,"true"==i.sfFlag?i.condtionalParaFlag=!0:"false"==i.sfFlag?i.condtionalParaFlag=!1:"unset"==i.sfFlag&&(i.condtionalParaFlag=!1)},i.submitForm=function(){i.formSubmitted=!0,i.submitStatus="IN_PROGRESS",i.setCurrentPage(null);var e=i.onSubmit();e.then(function(){i.submitStatus="SUCCESS"})["catch"](function(){i.submitStatus="ERROR"})},i.setCurrentPage=function(t){return i.currentPage=t,t?(i.setDefaultNextPage(),void i.initResponsesForCurrentPage()):(i.buttons.submitForm.visible=!1,e.submitButton=i.buttons.submitForm.visible,e.formValid=i.form,i.buttons.prevPage.visible=!1,void(i.buttons.nextPage.visible=!1))},i.setDefaultNextPage=function(){var t=i.formData.pages.indexOf(i.currentPage);if(i.currentPage.isFirst=0==t,i.currentPage.isLast=t==i.formData.pages.length-1,i.buttons.submitForm.visible=i.currentPage.isLast,e.submitButton=i.buttons.submitForm.visible,e.formValid=i.form,i.buttons.prevPage.visible=!i.currentPage.isFirst,i.buttons.nextPage.visible=!i.currentPage.isLast,i.currentPage.isLast?i.nextPage=null:i.nextPage=i.formData.pages[t+1],i.currentPage.pageFlow){var n=!1;i.currentPage.pageFlow.formSubmit?(i.nextPage=null,n=!0):i.currentPage.pageFlow.page?(i.nextPage=i.pageIdToPage[i.currentPage.pageFlow.page.id],i.buttons.nextPage.visible=!0):i.currentPage.isLast&&(i.nextPage=null,n=!0),i.buttons.submitForm.visible=n,e.submitButton=i.buttons.submitForm.visible,e.formValid=i.form,i.buttons.nextPage.visible=!n}},i.initResponsesForCurrentPage=function(){i.currentPage.elements.forEach(function(e){var t=e.question;t&&!i.responseData[t.id]&&(i.responseData[t.id]={})})},i.beginResponse=function(){i.formData.pages.length>0&&(i.setCurrentPage(i.formData.pages[0]),e.$broadcast("mwForm.pageEvents.pageCurrentChanged",{currentPage:i.currentPage}))},i.resetPages=function(){i.prevPages=[],i.currentPage=null,i.nextPage=null,i.formSubmitted=!1,i.options.autoStart&&i.beginResponse()},i.goToPrevPage=function(){window.scrollTo(0,0),i.onBack();var t=i.prevPages.pop();i.setCurrentPage(t),i.updateNextPageBasedOnAllAnswers(),e.$broadcast("mwForm.pageEvents.pageCurrentChanged",{currentPage:i.currentPage})},i.goToNextPage=function(){window.scrollTo(0,0),i.onSave(),i.prevPages.push(i.currentPage),i.updateNextPageBasedOnAllAnswers(),i.setCurrentPage(i.nextPage),e.$broadcast("mwForm.pageEvents.pageCurrentChanged",{currentPage:i.currentPage})},i.updateNextPageBasedOnAllAnswers=function(){i.currentPage.elements.forEach(function(e){i.updateNextPageBasedOnPageElementAnswers(e)}),i.buttons.submitForm.visible=!i.nextPage,e.submitButton=i.buttons.submitForm.visible,e.formValid=i.form,i.buttons.nextPage.visible=!!i.nextPage},i.updateNextPageBasedOnPageElementAnswers=function(e){var t=e.question;t&&t.pageFlowModifier&&t.offeredAnswers.forEach(function(e){e.pageFlow&&i.responseData[t.id].selectedAnswer==e.id&&(e.pageFlow.formSubmit?i.nextPage=null:e.pageFlow.page&&(i.nextPage=i.pageIdToPage[e.pageFlow.page.id]))})},i.onResponseChanged=function(e){i.setDefaultNextPage(),i.updateNextPageBasedOnAllAnswers()},i.print=function(e){return e&&i.templateData?n(e)(i.templateData):e},1===angular.version.major&&angular.version.minor<5&&i.$onInit()}],link:function(t,n,o){var s=t.ctrl;s.formStatus&&(s.formStatus.form=s.form),t.$on("mwForm.pageEvents.changePage",function(t,n){if("undefined"!=typeof n.page&&n.page<s.formData.pages.length){s.resetPages();for(var o=0;o<n.page;o++)s.prevPages.push(s.formData.pages[o]);var r=s.formData.pages[n.page];s.setCurrentPage(r),e.$broadcast("mwForm.pageEvents.pageCurrentChanged",{currentPage:r}),s.updateNextPageBasedOnAllAnswers()}})}}}]),angular.module("mwFormViewer").factory("FormQuestionId",function(){var e=0;return{next:function(){return++e}}}),angular.module("mwFormViewer").directive("mwFormQuestion",["$parse","$rootScope",function(e,t){return{replace:!0,restrict:"AE",require:"^mwFormViewer",scope:{question:"=",questionResponse:"=",readOnly:"=?",options:"=?",onResponseChanged:"&?"},templateUrl:"mw-form-question.html",controllerAs:"ctrl",bindToController:!0,controller:["$timeout","FormQuestionId",function(e,t){var n=this;n.largeFileFlag=!1,n.fileSelectedEvent=!1,this.$onInit=function(){n.id=t.next(),"radio"==n.question.type?n.questionResponse.other&&(n.isOtherAnswer=!0):"checkbox"==n.question.type?(n.questionResponse.selectedAnswers&&n.questionResponse.selectedAnswers.length?n.selectedAnswer=!0:n.questionResponse.selectedAnswers=[],n.questionResponse.other&&(n.isOtherAnswer=!0)):"grid"==n.question.type?n.question.grid.cellInputType||(n.question.grid.cellInputType="radio"):"division"==n.question.type?(n.computeDivisionSum=function(){n.divisionSum=0,n.question.divisionList.forEach(function(e){0==n.questionResponse[e.id]||n.questionResponse[e.id]?n.divisionSum+=n.questionResponse[e.id]:(n.questionResponse[e.id]=null,n.divisionSum+=0)})},n.computeDivisionSum()):"date"==n.question.type||"datetime"==n.question.type||"time"==n.question.type?n.questionResponse.answer&&(n.questionResponse.answer=new Date(n.questionResponse.answer)):"file"==n.question.type&&(n.questionResponse.fileName=n.questionResponse.fileName_1,n.questionResponse.answer=n.questionResponse.answer),n.isAnswerSelected=!1,n.initialized=!0},n.selectedAnswerChanged=function(){delete n.questionResponse.other,n.isOtherAnswer=!1,n.answerChanged()},n.otherAnswerRadioChanged=function(){n.isOtherAnswer&&(n.questionResponse.selectedAnswer=null),n.answerChanged()},n.otherAnswerCheckboxChanged=function(){n.isOtherAnswer||delete n.questionResponse.other,n.selectedAnswer=!(!n.questionResponse.selectedAnswers.length&&!n.isOtherAnswer)||null,n.answerChanged()},n.toggleSelectedAnswer=function(e){n.questionResponse.selectedAnswers.indexOf(e.id)===-1?n.questionResponse.selectedAnswers.push(e.id):n.questionResponse.selectedAnswers.splice(n.questionResponse.selectedAnswers.indexOf(e.id),1),n.selectedAnswer=!(!n.questionResponse.selectedAnswers.length&&!n.isOtherAnswer)||null,n.answerChanged()},n.answerChanged=function(){n.onResponseChanged&&n.onResponseChanged()},1===angular.version.major&&angular.version.minor<5&&this.$onInit()}],link:function(e,n,o,s){var r=e.ctrl;r.print=s.print,n.bind("change",function(n){var o=n.target.files[0].size/1024;if(void 0,o<=1024){r.largeFileFlag=!1,r.fileSelectedEvent=!0,t.$broadcast("fileRequiredFlag",r.largeFileFlag);var s=new FileReader;n.target.files[0];s.onload=function(t){e.$apply(function(){r.questionResponse.answer=t.target.result,r.questionResponse.fileName=n.target.files[0].name,r.questionResponse.fileName_1=n.target.files[0].name})},s.readAsDataURL(n.target.files[0])}else r.largeFileFlag=!0,t.$broadcast("fileRequiredFlag",r.largeFileFlag),void 0})}}}]),angular.module("mwFormViewer").directive("mwFormConfirmationPage",function(){return{replace:!0,restrict:"AE",require:"^mwFormViewer",scope:{submitStatus:"=",confirmationMessage:"=",readOnly:"=?"},templateUrl:"mw-form-confirmation-page.html",controllerAs:"ctrl",bindToController:!0,controller:function(){},link:function(e,t,n,o){var s=e.ctrl;s.print=o.print}}});

